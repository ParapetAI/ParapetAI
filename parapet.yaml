version: 1

tenants:
  - name: default
    spend:
      daily_usd_cap: 5.0

services:
  - label: openai-app
    tenant: default
    allowed_routes:
      - openai
      - embeddings
    parapet_token_ref: openai_app_token_ref
  - label: local-app
    tenant: default
    allowed_routes:
      - local
    parapet_token_ref: local_app_token_ref

routes:
  - name: openai
    tenant: default
    provider:
      type: openai
      model: gpt-4o-mini
      endpoint_type: chat_completions
      provider_key_ref: openai_api_key_ref
      default_params:
        temperature: 0.7
        top_p: 0.9
    policy:
      max_tokens_in: 4000
      max_tokens_out: 4000
      budget_daily_usd: 2.0
      drift_strict: true
      drift_detection:
        sensitivity: medium  # low (25%), medium (15%), high (10%)
      redaction:
        mode: block
        patterns: ["email", "api_key", "ip", "phone"]
    # webhook:
    #   url: "https://e69b3bcf5784.ngrok-free.app"
    #   secret_ref: parapet_audit_hmac_secret_ref
    #   include_prompt_snippet: false
    #   events:
    #     policy_decisions: true
    #     request_errors: true
    #     provider_errors: true

  - name: embeddings
    tenant: default
    provider:
      type: openai
      model: text-embedding-3-small
      endpoint_type: embeddings
      provider_key_ref: openai_api_key_ref
    policy:
      max_tokens_in: 8000
      max_tokens_out: 0
      budget_daily_usd: 2.0
      drift_strict: true
      drift_detection:
        sensitivity: high  # More sensitive for embeddings (10% threshold)
      redaction:
        mode: block
        patterns: ["email", "api_key", "ip", "phone"]

  - name: local
    tenant: default
    provider:
      type: local
      model: deepseek-r1:8b
      endpoint_type: chat_completions
      endpoint: https://84cb0fa22d85.ngrok-free.app/v1/chat/completions
      default_params:
        temperature: 0.5
    policy:
      max_tokens_in: 4000
      max_tokens_out: 4000
      budget_daily_usd: 2.0
      drift_strict: true
      redaction:
        mode: warn
        patterns: ["email", "api_key", "ip", "phone"]
